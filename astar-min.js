// javascript-astar
// http://github.com/bgrins/javascript-astar
// Freely distributable under the MIT License.
// Implements the astar search algorithm in javascript using a binary heap.
var astar={init:function(a){for(var c=0,e=a.length;c<e;c++)for(var b=0,d=a[c].length;b<d;b++){var g=a[c][b];g.f=0;g.g=0;g.h=0;g.visited=!1;g.closed=!1;g.parent=null}},search:function(a,c,e,b){astar.init(a);var b=b||astar.manhattan,d=new BinaryHeap(function(a){return a.f});for(d.push(c);0<d.size();){c=d.pop();if(c===e){a=c;for(e=[];a.parent;)e.push(a),a=a.parent;return e.reverse()}c.closed=!0;for(var g=astar.neighbors(a,c),h=0,k=g.length;h<k;h++){var f=g[h];if(!f.closed&&!f.isWall()){var i=c.g+1,j=
f.visited;if(!j||i<f.g)f.visited=!0,f.parent=c,f.h=f.h||b(f.pos,e.pos),f.g=i,f.f=f.g+f.h,j?d.rescoreElement(f):d.push(f)}}}return[]},manhattan:function(a,c){var e=Math.abs(c.x-a.x),b=Math.abs(c.y-a.y);return e+b},neighbors:function(a,c){var e=[],b=c.x,d=c.y;a[b-1]&&a[b-1][d]&&e.push(a[b-1][d]);a[b+1]&&a[b+1][d]&&e.push(a[b+1][d]);a[b]&&a[b][d-1]&&e.push(a[b][d-1]);a[b]&&a[b][d+1]&&e.push(a[b][d+1]);return e}};
var GraphNodeType={OPEN:0,WALL:1};function Graph(a){for(var b=[],c,e,g=a.length,f=0;f<g;++f){c=a[f];e=c.length;b[f]=Array(e);for(var d=0;d<e;++d)b[f][d]=new GraphNode(f,d,c[d])}this.input=a;this.nodes=b}Graph.prototype.toString=function(){for(var a="\n",b=this.nodes,c,e,g,f,d=0,h=b.length;d<h;d++){c="";e=b[d];for(g=0,f=e.length;g<f;g++)c+=e[g].type+" ";a=a+c+"\n"}return a};function GraphNode(a,b,c){this.data={};this.x=a;this.y=b;this.pos={x:a,y:b};this.type=c}
GraphNode.prototype.toString=function(){return"["+this.x+" "+this.y+"]"};GraphNode.prototype.isWall=function(){return this.type==GraphNodeType.WALL};function BinaryHeap(a){this.content=[];this.scoreFunction=a}
BinaryHeap.prototype={push:function(a){this.content.push(a);this.sinkDown(this.content.length-1)},pop:function(){var a=this.content[0],b=this.content.pop();0<this.content.length&&(this.content[0]=b,this.bubbleUp(0));return a},remove:function(a){var b=this.content.indexOf(a),c=this.content.pop();b!==this.content.length-1&&(this.content[b]=c,this.scoreFunction(c)<this.scoreFunction(a)?this.sinkDown(b):this.bubbleUp(b))},size:function(){return this.content.length},rescoreElement:function(a){this.sinkDown(this.content.indexOf(a))},
sinkDown:function(a){for(var b=this.content[a];0<a;){var c=(a+1>>1)-1,e=this.content[c];if(this.scoreFunction(b)<this.scoreFunction(e))this.content[c]=b,this.content[a]=e,a=c;else break}},bubbleUp:function(a){for(var b=this.content.length,c=this.content[a],e=this.scoreFunction(c);;){var g=a+1<<1,f=g-1,d=null;if(f<b){var h=this.scoreFunction(this.content[f]);h<e&&(d=f)}if(g<b&&this.scoreFunction(this.content[g])<(null===d?e:h))d=g;if(null!==d)this.content[a]=this.content[d],this.content[d]=c,a=d;else break}}};
